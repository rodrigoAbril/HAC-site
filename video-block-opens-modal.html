<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="//code.jquery.com/jquery-latest.js"></script>
    <link href="site.css" type="text/css" rel="stylesheet"/>
    <link href="//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.css" type="text/css" rel="stylesheet"/>
    <style>
        .flex-row {
            display: flex;
            flex-direction: row;
        }

        a {
            font-family: inter, serif;
            font-size: 28px;
            font-style: normal;
            font-weight: 300;
            letter-spacing: 1px;
            line-height: 39.2px;
            text-decoration: none;
            text-size-adjust: 100%;
            text-transform: none;
            color: black;
        }

        .dev .generateVideo:empty::before {
            content: attr(data-title);
            display: block;
            border: 1px solid #000;
            width: 100%;
        }


        .header-title {
            display: flex;
        }

        .header-title-logo,
        .header-mobile-logo {
            width: 100px;
            display: inline-block;
            position: relative;
        }

        .header-title-logo img,
        .header-title-logo video,
        .header-mobile-logo img,
        .header-mobile-logo video {
            max-width: 100%;
        }


        .titles-row {
            display: flex;
        }

        .titles-titles {
            flex-grow: 0;
            flex-shrink: 0;
            width: 40%;
        }

        .titles-description p {
            font-size: calc((1 - 1) * 1.2vw + 1rem);
            line-height: 1.4em;
        }

    </style>
</head>
<body>
<div class="dev" style="padding: 300px 0;">
    <div class="
                    header-title
                    header-title--use-mobile-logo
                  " data-animation-role="header-element">

        <div class="header-title-logo">
            <a href="/" data-animation-role="header-element">
                <picture>
                    <img src="//images.squarespace-cdn.com/content/v1/604a5cc8bb78f96c481a92e8/33a41244-0984-4891-a524-84372708e56b/HAC-LogoMark-005.png?format=1500w"
                         alt="HUE+CRY" class="nightLogo">
                </picture>
            </a>
        </div>


        <div class="header-mobile-logo">
            <a href="/" data-animation-role="header-element">
                <picture>
                    <img src="//images.squarespace-cdn.com/content/v1/604a5cc8bb78f96c481a92e8/9eb2e9d9-c053-4a97-85b8-c6df9338d1bf/HueAndCry_Icons-01.png?format=1500w"
                         alt="HUE+CRY">
                </picture>
            </a>
        </div>

    </div>
    <div class="flex-row">
        <div style="width: 600px; height: auto;">
            <div class="generateVideo"
                 data-thumbnail="666059011?h=6aa58dc41c"
                 data-video="673746465?h=11ccba6467"
                 data-aspectratio="aspectRatio1x1"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
        <div style="width: 1067px; height: auto">
            <div class="generateVideo"
                 data-video="673746465?h=11ccba6467"
                 data-aspectratio="aspectRatio16x9"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
                 data-description="How do you make picking a number more fun? By making each number a character, of course. Yebo provided some laugh-out-loud character outlines, and we were off the the races"
            ></div>
        </div>
        <div class="generateIntro"
             data-title="Title"
             data-subtitle="Video Subtitle"
             data-description="How do you make picking a number more fun? By making each number a character, of course. Yebo provided some laugh-out-loud character outlines, and we were off the the races"
        ></div>
    </div>
    <div class="flex-row">
        <div style="width: 600px; height: auto;">
            <div class="generateVideo"
                 data-video="666059011?h=6aa58dc41c"
                 data-aspectratio="aspectRatio1x1"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
        <div style="width: 1067px; height: auto">
            <div class="generateVideo"
                 data-video="673746465?h=11ccba6467"
                 data-aspectratio="aspectRatio16x9"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
        <div style="width: 800px; height: auto">
            <div class="generateVideo"
                 data-video="677308836?h=2296265f44"
                 data-aspectratio="aspectRatio4x3"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
    </div>
    <div class="flex-row">
        <div style="width: 600px; height: auto;">
            <div class="generateVideo"
                 data-video="666059011?h=6aa58dc41c"
                 data-aspectratio="aspectRatio1x1"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
        <div style="width: 1067px; height: auto">
            <div class="generateVideo"
                 data-video="673746465?h=11ccba6467"
                 data-aspectratio="aspectRatio16x9"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
        <div style="width: 800px; height: auto">
            <div class="generateVideo"
                 data-video="677308836?h=2296265f44"
                 data-aspectratio="aspectRatio4x3"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
    </div>
    <div class="flex-row">
        <div style="width: 600px; height: auto;">
            <div class="generateVideo"
                 data-video="666059011?h=6aa58dc41c"
                 data-aspectratio="aspectRatio1x1"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
        <div style="width: 1067px; height: auto">
            <div class="generateVideo"
                 data-video="673746465?h=11ccba6467"
                 data-aspectratio="aspectRatio16x9"
                 data-title="Video Title"
                 data-subtitle="Video Subtitle"
                 data-modal="true"
            ></div>
        </div>
    </div>
</div>



</body>
<script>
    let players = {};

    const aspectRatioValues = {
        aspectRatio1x1: {
            cssClass: "aspectRatio1x1",
            height: "1080px",
            width: "1080px",
            maxHeight: "85vh",
            maxWidth: "85vh",
        },
        aspectRatio16x9: {
            cssClass: "aspectRatio16x9",
            height: "1080px",
            width: "1920px",
            maxHeight: "1080px",
            maxWidth: "1920px",
        },
        aspectRatio4x3: {
            cssClass: "aspectRatio4x3",
            height: "1080px",
            width: "1440px",
            maxHeight: "1080px",
            maxWidth: "1440px",
        },
        aspectRatio4x5: {
            cssClass: "aspectRatio4x5",
            height: "1350px",
            width: "1080px",
            maxHeight: "1350px",
            maxWidth: "1080px",
        },
    }

    async function pausePlayer(playerId) {
        if (players[playerId]?.status === "pause") return;
        const pause = () => {
            return players[playerId]?.player.pause();
        };

        await pause().then(() => {
            players[playerId].status = "pause"
            console.log('---File: video-block-opens-modal.html, Line 178 playerId, ():', playerId, players[playerId]);
        });

    }

    async function playPlayer(playerId) {
        if (players[playerId]?.status === "play") return;
        const play = () => {
            return players[playerId]?.player.play();
        };
        await play().then(() => {
            players[playerId].status = "play";
            console.log('---File: video-block-opens-modal.html, Line 178 playerId, ():', playerId, players[playerId]);
        })

    }

    function elementInViewport(element) {
        const bounding = element.getBoundingClientRect();
        const elementHeight = element.offsetHeight + 500;

        return bounding.top >= -elementHeight
            && bounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) + elementHeight;

    }

    const generateIntro = (titleData) => {
        const [title, subTitle, description] = titleData
        const titles = `<p class="sqsrte-large hover-spin-child">
                            <strong>${title}</strong>
                            <br/><span class="spin-this">+</span> ${subTitle}️
                        </p>`
        return description ?
            `<div class="titles-row">
                    <div class="titles-titles">
                        ${titles}
                    </div>
                    <div class="titles-description">
                        <p>${description}</p><p><strong class="description-link">VIEW MORE →</strong></p>
                    </div>
                </div>`
            :
            `${titles}`;
    }

    const generateVideo = (videoData) => {
        const [videoId, thumbnailId, aspectRatio, title, subTitle, description, hasModal, linkUrl, id] = videoData;
        const iframe = `<div class="vimeoVideo ${aspectRatioValues[aspectRatio].cssClass}">
                            <div class="vimeoVideo-block"></div>
                            <iframe id="iframe_${id}" src="https://player.vimeo.com/video/${thumbnailId ?? videoId}&amp;title=0&amp;byline=0&amp;portrait=0&amp;speed=0&amp;badge=0&amp;background=1&amp;muted=1&amp;autoplay=1&amp;" frameborder="0"  style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;"></iframe>
                        </div>`

        if (hasModal) {
            return $(`
                    <a href="https://player.vimeo.com/video/${videoId ?? thumbnailId}"
                        data-featherlight="iframe"
                        data-featherlight-iframe-frameborder="0"
                        data-featherlight-iframe-allow="autoplay; encrypted-media"
                        data-featherlight-iframe-allowfullscreen="true"
                        data-featherlight-iframe-style="
                            display:block;
                            border:none;
                            height:${aspectRatioValues[aspectRatio].height};
                            width:${aspectRatioValues[aspectRatio].width};
                            max-height:90vh;
                            max-width:100%;
                        "
                    >
                        ${iframe}
                        ${generateIntro([title, subTitle, description])}
                    </a>
                `);
        } else {
            return $(`
                    <a href="${linkUrl}">${iframe}${generateIntro([title, subTitle, description])}</a>
                `);
        }
    };


    function addToPlayers(playerId) {
        players = {
            ...players,
            [playerId]: {
                status: "play",
                player: new Vimeo.Player(`iframe_${playerId}`),
            },
        }
    }

    function renderIntro() {
        console.log('this :', $(this));
        const generateIntroData = [
            $(this).data("title"),
            $(this).data("subtitle"),
            $(this).data("description"),
        ]
        const $generatedIntro = generateIntro(generateIntroData);

        $($generatedIntro).appendTo($(this))

    }

    function renderVideo() {
        const playerId = $(this).attr("id");

        const generateVideoData = [
            $(this).data("video"),
            $(this).data("thumbnail"),
            $(this).data("aspectratio"),
            $(this).data("title"),
            $(this).data("subtitle"),
            $(this).data("description"),
            $(this).data("modal"),
            $(this).data("link"),
            playerId,
        ]

        const $generatedVideo = generateVideo(generateVideoData);

        $generatedVideo.appendTo($(this))
        $(this).data("loaded", true);
        $(this).addClass("loaded");
        addToPlayers(playerId);
    }

    function videoMagic() {
        $('.generateVideo').each(function () {
            const playerId = $(this).attr("id");
            const element = document.querySelector(`#${playerId}`);
            const inView = elementInViewport(element);
            if ($(this).data("loaded")) {
                if (inView) {
                    playPlayer(playerId)
                } else {
                    pausePlayer(playerId)
                }
            } else {
                if (inView) {
                    renderVideo.call(this);
                }
            }
        })
    }

    const $body = $("body");

    function isNight() {
        let date = new Date();
        return (date.getHours() > 21 || date.getHours() < 6);
    }


    function changeLogoToVideo() {
        const logoSrcNight = "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6237b0a7e5909a1d79e51017/1647816872257/HAC-LogoMark-HoverState-NightMode-V2.mp4"
        const logoSrcDay = "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620efda1203ace79d2f6a70c/1645149602471/HAC-LogoMark-HoverState-001.mp4"


        const videoElement = document.createElement("video");

        const existingLogoVideo = document.querySelector("#logoVideo");


        if (existingLogoVideo) {
            existingLogoVideo.play();
            return;
        }

        videoElement.cssClass = "logoVideo";
        videoElement.muted = true;
        videoElement.autoplay = true;
        videoElement.loop = isNight();

        const sourceMP4 = document.createElement("source");
        sourceMP4.type = "video/mp4";
        sourceMP4.src = isNight() ? logoSrcNight : logoSrcDay;

        videoElement.appendChild(sourceMP4);

        const logoLink = document.querySelector(".header-display-desktop .header-title-logo a");
        logoLink.appendChild(videoElement);

        const mobileLogoLink = document.querySelector(".header-display-mobile .header-mobile-logo a");
        mobileLogoLink.appendChild(videoElement.cloneNode(true));
    }


    $(document).ready(function () {

        $('.generateVideo').each(function (index) {
            $(this).attr("id", `video_${index}`);
        });

        $('.generateIntro').each(function () {
            renderIntro.call(this);
        });

        // video pause if not in view
        $(window).on('load', function () {
            videoMagic();
        })

        $(window).on('scroll', function () {
            videoMagic();
        });

        $(".header-title-logo").on({
            mouseenter: function () {
                if (isNight()) return;
                changeLogoToVideo();
            },
        });


        changeLogoToVideo();

    })
</script>
<script src="//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js" type="text/javascript"
        charSet="utf-8"></script>
</html>