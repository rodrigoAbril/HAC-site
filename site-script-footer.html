<script>
    const media = {
        staff: {
            TRISH: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6209775ae6470f1f2d315e0e/1644787546531/Trish.jpg",
            TRAVIS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6209776c93dd371732167d3e/1644787564463/Travis.jpg",
            SCOTT: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/62097774d0bc844e2922e746/1644787572953/Scott.jpg",
            NED: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6209777b82cb265dbd168743/1644787580024/Ned.jpg",
            // MEAGAN: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6209779c3dea9e22f64a13fd/1644787612761/Meagan.jpg",
            MATT: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6209779f97c817535f7c9bf8/1644787615988/Matt.jpg",
            DAVID: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6212bda437825817834c4296/1645395364169/H%2BC-Thumbnail-Portrait-David-001.jpg",
            MAGNUS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620977a56f98284656523eca/1644787621163/Magnus.jpg",
            LUIS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620977a993dd3717321687c9/1644787625062/Luis.jpeg",
            LAUREN: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620977ae6a25c62651beb02e/1644787630530/Lauren.jpg",
            JEFF: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620977b23dea9e22f64a145b/1644787634134/Jeff.jpg",
            CLOIE: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620977b7b3e3450810523d0a/1644787639180/Cloie.jpg",
            "2D": "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea9f9292523d97eb2eae/1645472416003/2d-01.mp4",
            "3D": "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea9a08b81e4eb28d57e3/1645472411649/3d-01.mp4",
            HUE: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea859906252fdcc6b670/1645472390762/hue-02.mp4",
            VISIONS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea828e7a9668f914a5e5/1645472386866/Visions.mp4",
            DREAMERS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea7f950bf9555b02d16a/1645472383722/Dreamers.mp4",
            FOCUS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea7b9292523d97eb2457/1645472380326/focus-01.mp4",
            SMART: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea7524b61e3d855952b7/1645472374156/Smart-01.mp4",
            DEDICATED: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea611ae20428751a9619/1645472355224/Dedicated.mp4",
            DESIGN: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea5aa70ac112b7ec8f67/1645472348201/design-02.mp4",
            DOODLES: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea566df7e40af5df77b8/1645472343168/doodles-01.mp4",
            HELPFUL: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea5390fb27351fd4fe4b/1645472339323/helpful-01.mp4",
            PINGPONG: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea4d6df7e40af5df7789/1645472334556/PingPong-02.mp4",
            PROLIFIC: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea48bd615301ff3ee287/1645472329553/Prolific-01.mp4",
            TWEENS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213ea000a711978e9d0bacd/1645472256709/Tweening-01.mp4",
            ANIMATION: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213e9f9736f44135015e89f/1645472249400/animation-01.mp4",
            KEYFRAMES: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213e9f124b61e3d85593963/1645472242078/keyframes-02.mp4",
            STORYTELLING: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213e9e7f4299a52e51bca29/1645472231796/storytelling-01.mp4",
            ILLUSTRATION: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213e9e11ce03e3033b293e3/1645472225165/illustration-01.mp4",
            COLLABORATORS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213e9d277cccf0f0a496cf4/1645472211505/Collaborators-01.mp4",
            CANDID: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c47431c3c7c0e56aaa58c/1644971843965/HAC-NatGeo.mp4",
            CRY: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213efcf1ae20428751b5b65/1645473744575/Cry-02.mp4",
        },

        archive: {
            TINYTRIUMPHS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c46b8aade6223855ccb4c/1644971704847/HAC-TinyTriumphs.mp4",
            OREOALADDIN: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c470754ea6050fc9d0bde/1644971785760/HAC-OreoAladdin.mp4",
            OREOWONDER: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c470de59603681053a012/1644971791106/HAC-OreoWonder.mp4",
            CHIPSAHOY: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c4713e391d407642d4e9c/1644971796663/HAC-ChipsAhoy.mp4",
            BONEYARD: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c471e0375e45bf73c2c94/1644971806786/HAC-BONEYARD.png",
            CENTRUM: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c4728de88c5539e8222be/1644971818668/HAC-Centrum.mp4",
            COSTEAU: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c47312fb1da024c00693c/1644971826266/HAC-Costeau.mp4",
            ITSLIT: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c4736c965721edcd7ec75/1644971833432/HAC-ItsLit.mp4",
            NATGEO: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c47431c3c7c0e56aaa58c/1644971843965/HAC-NatGeo.mp4",
            ETHOS: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c474886dd0b07e9dbec76/1644971848474/HAC-Ethos.png",
            CHEVY: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c474e54ea6050fc9d13d8/1644971856905/HAC-Chevy.mp4",
            BUDDY: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c4754ffc2d75be282baf9/1644971860825/HAC-Buddy.mp4",
            STOLI: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c475a70a7852020d9b7f9/1644971867561/HAC-Stoli.mp4",
            RITZ: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620c47608716c305b0450214/1644971873255/HAC-Ritz.mp4",
            NCLOTTO: "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/6213eec0cd2a8b58ad39e3cc/1645473473248/NCL-Loaded-6second-1-Space-013-Archive-Hover-Thumbnail-001.mp4",
        },

        links: {
            TINYTRIUMPHS: "/tiny-triumphs",
            OREOALADDIN: "/aladdin",
            OREOWONDER: "/wonder",
            CHIPSAHOY: "/chips-ahoy",
            BONEYARD: "/boneyard",
            CENTRUM: "/centrum",
            COSTEAU: "/costeau",
            ITSLIT: "/its-lit",
            NATGEO: "/natgeo",
            ETHOS: "/ethos",
            CHEVY: "/chevy",
            BUDDY: "/buddy",
            STOLI: "/stoli",
            RITZ: "/ritz",
            MOBILEPLAY: "/mobile-play",
            NCLOTTO: "/nc-lotto",
        }
    }

    let players = {};

    const aspectRatioValues = {
        aspectRatio1x1: {
            cssClass: "aspectRatio1x1",
            height: "1080px",
            width: "1080px",
            maxHeight: "85vh",
            maxWidth: "85vh",
        },
        aspectRatio16x9: {
            cssClass: "aspectRatio16x9",
            height: "1080px",
            width: "1920px",
            maxHeight: "96vh",
            maxWidth: "96vw",
        },
        aspectRatio4x3: {
            cssClass: "aspectRatio4x3",
            height: "1080px",
            width: "1440px",
            maxHeight: "96vh",
            maxWidth: "96vw",
        },
        aspectRatio4x5: {
            cssClass: "aspectRatio4x5",
            height: "1350px",
            width: "1080px",
            maxHeight: "96vh",
            maxWidth: "96vw",
        },
    }

    async function pausePlayer(playerId) {
        if (players[playerId]?.status === "pause") return;
        const pause = () => {
            return players[playerId]?.player.pause();
        };

        await pause().then(() => {
            players[playerId].status = "pause"
        });

    }

    async function playPlayer(playerId) {
        if (players[playerId]?.status === "play") return;
        const play = () => {
            return players[playerId]?.player.play();
        };
        await play().then(() => {
            players[playerId].status = "play";
        })

    }

    function elementInViewport(element) {
        const bounding = element.getBoundingClientRect();
        const elementHeight = element.offsetHeight + 500;

        return bounding.top >= -elementHeight
            && bounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) + elementHeight;

    }

    const generateVideo = (videoData) => {
        const [videoId, aspectRatio, title, subTitle, hasModal, linkUrl, id] = videoData;
        const iframe = `<div class="vimeoVideo ${aspectRatioValues[aspectRatio].cssClass}">
                            <div class="vimeoVideo-block"></div>
                            <iframe id="iframe_${id}" src="https://player.vimeo.com/video/${videoId}&amp;title=0&amp;byline=0&amp;portrait=0&amp;speed=0&amp;badge=0&amp;background=1&amp;muted=1&amp;autoplay=1&amp;" frameborder="0"  style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;"></iframe>
                        </div>`
        const titles = `<p class="sqsrte-large hover-spin-child">
                            <strong>${title}</strong>
                            <br/><span class="spin-this">+</span> ${subTitle}Ô∏è
                        </p>`
        if (hasModal) {
            return $(`
                    <a href="https://player.vimeo.com/video/${videoId}"
                        data-featherlight="iframe"
                        data-featherlight-iframe-frameborder="0"
                        data-featherlight-iframe-allow="autoplay; encrypted-media"
                        data-featherlight-iframe-allowfullscreen="true"
                        data-featherlight-iframe-style="
                            display:block;
                            border:none;
                            height:${aspectRatioValues[aspectRatio].height};
                            width:${aspectRatioValues[aspectRatio].width};
                            max-height:90vh;
                            max-width:100%;
                        "
                    >${iframe}${titles}</a>
                `);
        } else {
            return $(`
                    <a href="${linkUrl}">${iframe}${titles}</a>
                `);
        }
    };


    function addToPlayers(playerId) {
        players = {
            ...players,
            [playerId]: {
                status: "play",
                player: new Vimeo.Player(`iframe_${playerId}`),
            },
        }
    }

    function renderVideo() {
        const playerId = $(this).attr("id");

        const generateVideoData = [
            $(this).data("video"),
            $(this).data("aspectratio"),
            $(this).data("title"),
            $(this).data("subtitle"),
            $(this).data("modal"),
            $(this).data("link"),
            playerId,
        ]
        const $generatedVideo = generateVideo(generateVideoData);

        $generatedVideo.appendTo($(this))
        $(this).data("loaded", true);
        $(this).addClass("loaded");
        addToPlayers(playerId);
    }

    function videoMagic() {
        $('.generateVideo').each(function () {
            const playerId = $(this).attr("id");
            const element = document.querySelector(`#${playerId}`);
            const inView = elementInViewport(element);
            if ($(this).data("loaded")) {
                if (inView) {
                    playPlayer(playerId)
                } else {
                    pausePlayer(playerId)
                }
            } else {
                if (inView) {
                    renderVideo.call(this);
                }
            }
        })
    }

    $(document).ready(function () {
        const $body = $("body");

        function isNight() {
            let date = new Date();
            return (date.getHours() > 21 || date.getHours() < 6);
        }

        function changeLogoToVideo() {
            const logoSrcNight = "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620efdafb68e2f570548950a/1645149616134/HAC-LogoMark-NightMode-001.mp4"
            const logoSrcDay = "https://static1.squarespace.com/static/604a5cc8bb78f96c481a92e8/t/620efda1203ace79d2f6a70c/1645149602471/HAC-LogoMark-HoverState-001.mp4"


            const videlem = document.createElement("video");

            const existingLogoVideo = document.querySelector("#logoVideo");

            if (existingLogoVideo) {
                existingLogoVideo.play();
                return;
            }

            videlem.id = "logoVideo";
            videlem.cssClass = "logoVideo";
            videlem.muted = true;
            videlem.autoplay = true;
            videlem.loop = isNight();

            const sourceMP4 = document.createElement("source");
            sourceMP4.type = "video/mp4";
            sourceMP4.src = isNight() ? logoSrcNight : logoSrcDay;
            videlem.appendChild(sourceMP4);
            const logoLink = document.querySelector(".header-title-logo a");
            logoLink.appendChild(videlem);

        }


        $(".header-title-logo").on({
            mouseenter: function () {
                if (isNight()) return;
                changeLogoToVideo();
            },
        });


        changeLogoToVideo();

        if (isNight()) {
            $(".header-title-logo img").addClass("nightLogo");
            $(".sloganSvg svg").css("fill", "white");
            $body.addClass("nightMode");
            $body.css("background-color", "black");
            $("section.page-section.white, header.header.white").toggleClass("white", "bright-inverse");
        }

        function at(n) {
            // ToInteger() abstract op
            n = Math.trunc(n) || 0;
            // Allow negative indexing from the end
            if (n < 0) n += this.length;
            // OOB access is guaranteed to return undefined
            if (n < 0 || n >= this.length) return undefined;
            // Otherwise, this is just normal property access
            return this[n];
        }

        const TypedArray = Reflect.getPrototypeOf(Int8Array);
        for (const C of [Array, String, TypedArray]) {
            Object.defineProperty(C.prototype, "at",
                {
                    value: at,
                    writable: true,
                    enumerable: false,
                    configurable: true
                });
        }


        // adding hover and styles to archive and about us words
        $('.words-hover').each(function () {
            const words = $(this).text().split(' + ');
            $(this).empty().html(function () {
                for (i = 0; i < words.length; i++) {
                    const objectToSearch = $(this).closest(".links-with-hover-media").attr('id');
                    const keyToSearch = words[i].replace(/ /g, '').replace("'", '').toUpperCase();
                    const hasHover = media[objectToSearch][keyToSearch] ? "showHover" : "noHover";
                    const link = media.links[keyToSearch];
                    const mediaType = media[objectToSearch][keyToSearch]?.split('.').at(-1) ?? "none";

                    if (link) {
                        if (i === 0) {
                            $(this).append(`<a href="${link}"><span class="words-hover-word ${hasHover} ${words[i]} ${mediaType}" id="${keyToSearch}">${words[i]}</span></a> `);
                        } else {
                            $(this).append(`+ <a href="${link}"><span class="words-hover-word ${hasHover} ${words[i]} ${mediaType}" id="${keyToSearch}">${words[i]}</span></a> `);
                        }
                    } else {
                        if (i === 0) {
                            $(this).append(`<span class="words-hover-word ${hasHover} ${words[i]} ${mediaType}" id="${keyToSearch}">${words[i]}</span> `);
                        } else {
                            $(this).append(`+ <span class="words-hover-word ${hasHover} ${words[i]} ${mediaType}" id="${keyToSearch}">${words[i]}</span> `);
                        }
                    }

                }

            });

        });

        // adding image behind about us list
        const $hoverTail = $(`<div id="tail">
                <video
                id="popUpVideo"
                autoplay
                loop
                muted
                >
                    <source type="video/mp4" src="" id="video_src">
                </video>
            </div>`);
        const $aboutUsHoverText = $(".words-hover-word.showHover");
        $hoverTail.appendTo($body);

        $(document).on('mousemove', ".words-hover-word.showHover", function (e) {
            const objectToSearch = $(this).closest(".links-with-hover-media").attr('id');
            const keyToSearch = $(this).attr('id');
            const hoverMedia = media[objectToSearch][keyToSearch];


            if (hoverMedia) {
                const isVideo = $(this).hasClass('mp4');
                $hoverTail.css({
                    left: e.pageX - 120,
                    top: e.pageY + 30,
                    height: "240px",
                    width: "240px",
                    "background-color": "white",
                    background: !isVideo ? `url(${hoverMedia})` : "",
                });
                if (isVideo) {
                    $("#video_src").attr("src", hoverMedia);
                } else {
                    $("#video_src").attr("src", "");
                }
            }
        });

        $aboutUsHoverText.bind('mouseleave', function () {
            const objectToSearch = $(this).closest(".links-with-hover-media").attr('id');
            const hoverBackground = media[objectToSearch][$(this).attr('id')];
            if (hoverBackground) {
                $hoverTail.css({
                    display: 'none'
                });
            }
        });
        $aboutUsHoverText.bind('mouseenter', function () {
            const objectToSearch = $(this).closest(".links-with-hover-media").attr('id');
            const hoverBackground = media[objectToSearch][$(this).attr('id')];
            if (hoverBackground) {
                $hoverTail.css({
                    display: 'block'
                });
                $("#popUpVideo").load()
            }
        });

        // generating videos

        $('.generateVideo').each(function (index) {
            $(this).attr("id", `video_${index}`);
        });

        // video pause if not in view
        $(window).on('load', function () {
            videoMagic();
        })

        $(window).on('scroll', function () {
            videoMagic();
        });

    });

</script>

<script src="//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js" type="text/javascript"
        charSet="utf-8"></script>